<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teleport for gaze and mouse on touch and desktop</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>  
  <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
  
</head>
<body>
  <a-scene>
    <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>
    <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E" shadow></a-sphere>
    <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>
    
    <a-entity id="cameraRig" position="0 2.2 4">
        <a-entity id="head" camera look-controls wasd-controls>
          <a-entity position="0 0 -3"
                    geometry="primitive: ring; radiusOuter: 0.30;
                              radiusInner: 0.20;"
                    material="color: cyan; shader: flat"
                    cursor="maxDistance: 30; fuse: true"
                    touch-listener
                    teleport-controls=
                        "cameraRig: #cameraRig;
                        teleportOrigin: #head;
                        startEvents:starttouch;
                        endEvents:endtouch;
                        curveShootingSpeed:15;
                        hitCylinderRadius:1;
                        collisionEntities: [ground]">
            <a-animation begin="click" easing="ease-in" attribute="scale"
                 fill="backwards" from="0.1 0.1 0.1" to="1 1 1" dur="150"></a-animation>
            <a-animation begin="fusing" easing="ease-in" attribute="scale"
                 fill="forwards" from="1 1 1" to="0.1 0.1 0.1" dur="1500"></a-animation>
          </a-entity>
        </a-entity>
    </a-entity>
    
    <a-entity ground
      environment="preset:tron"
      shadow
    ></a-entity>

    <a-entity ground
      geometry="primitive:box; width:10; depth:10; height:0.01;"
      material="color:#333"
      position="-5 0 -5"        
    >
    </a-entity>    
    
    <a-entity ground
      geometry="primitive:box; width:3; depth:3; height:2;"
      material="color:#666"
      position="-6 1 -6"        
    >
    </a-entity>    

    <a-entity ground
      geometry="primitive:box; width:3; depth:3; height:3;"
      material="color:#999"
      position="-3 1.5 -8"        
    >
    </a-entity>        
  
  </a-scene>  



</body>
<script>
    AFRAME.registerComponent('touch-listener', {
        init: function () {
            var targetEl = this.el;

            //Create the touchstart event
            document.querySelector('a-scene').addEventListener('touchstart', function () {
                targetEl.emit('starttouch')
            })

            document.querySelector('a-scene').addEventListener('mousedown', function () {
                targetEl.emit('starttouch')
            })

            document.querySelector('a-scene').addEventListener('click', function () {
                targetEl.emit('starttouch')
            })

            document.body.addEventListener('keydown', function (e) {
                if (e.keyCode == 32) {
                    console.log('space key pressed!');
                    targetEl.emit('starttouch');      
                }  
            })
            
            //Create the touchend event
            document.querySelector('a-scene').addEventListener('touchend', function () {
                targetEl.emit('endtouch')
            })
            
            document.querySelector('a-scene').addEventListener('mouseup', function () {
                targetEl.emit('endtouch')
            })

            document.querySelector('a-scene').addEventListener('fusing', function () {
                targetEl.emit('endtouch')
            })
            
            document.body.addEventListener('keyup', function (e) {
                if (e.keyCode == 32) {
                    console.log('space key released!');
                    targetEl.emit('endtouch');      
                }  
            })

            
        }
    });
</script>
</html>